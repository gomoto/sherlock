(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=["$locationProvider","$stateProvider","$urlRouterProvider",function(t,e,r){t.html5Mode(!0),r.otherwise("/"),e.state("brain",{url:"/",template:"<brain></brain>"}).state("janitor",{template:"<janitor></janitor>"}).state("note",{params:{note:null},template:"<note></note>"})}];

},{}],2:[function(require,module,exports){
"use strict";var app_routing_1=require("./app.routing"),brain_module_1=require("./brain/brain.module"),janitor_module_1=require("./janitor/janitor.module"),navbar_module_1=require("./navbar/navbar.module"),note_module_1=require("./note/note.module"),pouchdb_module_1=require("./pouchdb/pouchdb.module");angular.module("sherlock",["ui.router","ngTagsInput",brain_module_1["default"],janitor_module_1["default"],navbar_module_1["default"],note_module_1["default"],pouchdb_module_1["default"]]).config(app_routing_1["default"]);

},{"./app.routing":1,"./brain/brain.module":4,"./janitor/janitor.module":6,"./navbar/navbar.module":7,"./note/note.module":9,"./pouchdb/pouchdb.module":11}],3:[function(require,module,exports){
"use strict";var BrainController=function(){function t(t,e,n,o,s,l,i,a){var r=this;this.$document=t,this.$element=e,this.$log=n,this.pouchdb=o,this.$scope=s,this.$state=l,this.$timeout=i,this.$window=a,this.translate=function(){r.$timeout(function(){var t=r.calculateWidth("brain .level")+r.calculateWidth("brain .note"),e=r.calculateElementWidth(r.$element[0]),n=Math.max(0,t-e),o="translateX(-"+n+"px)";r.$element.css({webkitTransform:o,MozTransform:o,msTransform:o,OTransform:o,transform:o}),r.$log.debug("Translating %s pixels to the left",n)})},this.note=null,this.levels=[{selectedTag:null,tags:null,notes:null}],this.pouchdb.getAllTags().then(function(t){r.levels[0].tags=t}),this.pouchdb.getNotesWithTag(null).then(function(t){r.levels[0].notes=t})}return t.prototype.$onInit=function(){this.$log.debug("Initializing brain component"),this.$window.addEventListener("resize",this.translate,!1)},t.prototype.$onDestroy=function(){this.$log.debug("Destroying brain component"),this.$window.removeEventListener("resize",this.translate,!1)},t.prototype.onTitleMouseenter=function(t,e){this.openNote(e._id),this.assertLevel(t),this.levels[t].selectedTag=null},t.prototype.openNote=function(t){var e=this;this.$log.debug("opening note"),this.pouchdb.get(t).then(function(t){e.note=t,e.translate()})},t.prototype.closeNote=function(){null!==this.note&&(this.$log.debug("closing note"),this.note=null,this.translate())},t.prototype.onTagMouseenter=function(t,e){var n=this;this.closeNote(),this.assertLevel(t),this.levels[t].selectedTag=e.tag;var o=this.levels.map(function(t){return t.selectedTag});null===e.notes?this.pouchdb.getNotesWithTag(e.tag).then(function(t){n.buildNextLevel(t,o)}):this.buildNextLevel(e.notes,o)},t.prototype.buildNextLevel=function(t,e){var n={},o=[];t.forEach(function(t){var s=_.intersection(e,t.tags);s.length===t.tags.length?o.push(t):s.length===e.length&&t.tags.forEach(function(o){_.includes(e,o)||(n[o]||(n[o]=[]),n[o].push(t))})});var s=Object.keys(n).map(function(t){return{tag:t,notes:n[t]}}),l=_.sortBy(s,"tag");this.levels.push({selectedTag:null,tags:l,notes:o}),this.translate()},t.prototype.assertLevel=function(t){this.levels.length-1<=t||(this.$log.debug("Assert level ",t),this.levels.splice(t+1,this.levels.length),this.translate())},t.prototype.onLevelMouseover=function(t,e){this.closeNote(),this.assertLevel(e),this.levels[e].selectedTag=null},t.prototype.calculateWidth=function(t){for(var e=0,n=this.$document[0].querySelectorAll(t),o=0;o<n.length;o++)e+=this.calculateElementWidth(n.item(o));return e},t.prototype.calculateElementWidth=function(t){var e=this.$window.getComputedStyle(t).getPropertyValue("width");return parseFloat(e)},t.prototype.editNote=function(){this.$state.go("note",{note:this.note})},t.$inject=["$document","$element","$log","pouchdb","$scope","$state","$timeout","$window"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=BrainController;

},{}],4:[function(require,module,exports){
"use strict";var brain_controller_1=require("./brain.controller");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.brain",[]).component("brain",{templateUrl:"src/brain/brain.template.html",controller:brain_controller_1["default"]}).name;

},{"./brain.controller":3}],5:[function(require,module,exports){
"use strict";var JanitorController=function(){function t(t,o,e,n){this.$log=t,this.pouchdb=o,this.$state=e,this.$window=n,this.getAllNotes()}return t.prototype.toJson=function(t){return angular.toJson(t,!0)},t.prototype.getAllNotes=function(){var t=this;this.pouchdb.allNotes().then(function(o){t.$log.debug("allNotes response",o),t.notes=o.rows.map(function(t){return t.doc})})["catch"](this.$log.error)},t.prototype.deleteAllNotes=function(){var t=this;if(this.$window.confirm("Really delete all notes?")){this.$log.debug("Deleting all notes");var o=this.notes.map(function(t){return t._deleted=!0,t});this.pouchdb.bulkDocs(o).then(function(o){t.$log.debug("bulkDocs response",o),t.notes=[]})["catch"](this.$log.error)}},t.prototype.destroyDatabase=function(){var t=this;this.$window.confirm("Really destroy database?")&&(this.$log.debug("Destroying database"),this.pouchdb.destroy().then(function(o){t.$log.debug("db destroyed response",o),t.notes=[]}))},t.prototype.goToNote=function(t){this.$state.go("note",{note:t})},t.$inject=["$log","pouchdb","$state","$window"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=JanitorController;

},{}],6:[function(require,module,exports){
"use strict";var janitor_controller_1=require("./janitor.controller");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.janitor",[]).component("janitor",{templateUrl:"src/janitor/janitor.template.html",controller:janitor_controller_1["default"]}).name;

},{"./janitor.controller":5}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.navbar",[]).component("navbar",{templateUrl:"src/navbar/navbar.template.html"}).name;

},{}],8:[function(require,module,exports){
"use strict";var NoteController=function(){function t(t,e,o,s){this.$log=t,this.pouchdb=e,this.$stateParams=o,this.$window=s,this.setNoteState()}return t.prototype.setNoteState=function(){this.$stateParams.note?(this.title=this.$stateParams.note.title,this.content=this.$stateParams.note.content,this.tags=this.$stateParams.note.tags.map(function(t){return{text:t}})):(this.title="",this.content="",this.tags=[])},t.prototype.putNote=function(){var t,e=this;this.$stateParams.note&&(t=this.$stateParams.note._id);var o=this.tags.map(function(t){return t.text}),s={_id:t||this.createNoteId(),title:this.title,content:this.content,tags:o};this.$stateParams.note&&(s._rev=this.$stateParams.note._rev),this.pouchdb.put(s).then(function(t){e.$log.info(t),s._rev=t.rev,e.$stateParams.note=s})["catch"](function(t){e.$log.error("put note error",t)})},t.prototype.deleteNote=function(){var t=this;this.$stateParams.note&&this.$window.confirm("Really delete note?")&&(this.$stateParams.note._deleted=!0,this.pouchdb.put(this.$stateParams.note).then(function(e){t.$log.info(e),t.$stateParams.note=null,t.setNoteState()})["catch"](function(e){t.$log.error("del note error",e)}))},t.prototype.createNoteId=function(){return"note"+(new Date).getTime().toString()},t.$inject=["$log","pouchdb","$stateParams","$window"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=NoteController;

},{}],9:[function(require,module,exports){
"use strict";var note_controller_1=require("./note.controller");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.note",[]).component("note",{templateUrl:"src/note/note.template.html",controller:note_controller_1["default"]}).name;

},{"./note.controller":8}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={_id:"_design/tags",views:{tags:{map:function(t){if(t.tags)if(0===t.tags.length)emit(null,{title:t.title,tags:[]});else for(var e=0;e<t.tags.length;e++)emit(t.tags[e],{title:t.title,tags:t.tags})}.toString(),reduce:"_count"}}};

},{}],11:[function(require,module,exports){
"use strict";var pouchdb_service_1=require("./pouchdb.service");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.pouchdb",[]).service("pouchdb",pouchdb_service_1["default"]).name;

},{"./pouchdb.service":12}],12:[function(require,module,exports){
"use strict";var pouchdb_design_1=require("./pouchdb.design"),pouchdb=function(){function t(t,e){var o=this;this.$log=t,this.$q=e,this.db=new PouchDB("sherlock"),this.db.put(pouchdb_design_1["default"]).then(function(e){t.debug("design doc response",e)})["catch"](function(t){"conflict"!==t.name&&o.$log.error(t)})}return t.prototype.get=function(t){return this.$q.resolve(this.db.get(t))},t.prototype.put=function(t){return this.$q.resolve(this.db.put(t))},t.prototype.allDocs=function(t){return this.$q.resolve(this.db.allDocs(t))},t.prototype.allNotes=function(){var t={startkey:"note",endkey:"noteï¿°",include_docs:!0};return this.$q.resolve(this.db.allDocs(t))},t.prototype.bulkDocs=function(t){return this.$q.resolve(this.db.bulkDocs(t))},t.prototype.query=function(t,e){return this.$q.resolve(this.db.query(t,e))},t.prototype.destroy=function(){return this.$q.resolve(this.db.destroy())},t.prototype.getNotesWithTag=function(t){var e=this;return this.query("tags",{reduce:!1,key:t}).then(function(t){return e.$log.info("note query response",t),t.rows.map(function(t){return{_id:t.id,title:t.value.title,tags:t.value.tags}})})["catch"](this.$log.error)},t.prototype.getAllTags=function(){var t=this;return this.query("tags",{reduce:!0,group:!0}).then(function(e){return t.$log.info("tag query response",e),e.rows.filter(function(t){return null!==t.key}).map(function(t){return{tag:t.key,notes:null}})})["catch"](this.$log.error)},t.$inject=["$log","$q"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=pouchdb;

},{"./pouchdb.design":10}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLnJvdXRpbmcudHMiLCJzcmMvYXBwLnRzIiwic3JjL2JyYWluL2JyYWluLmNvbnRyb2xsZXIudHMiLCJzcmMvYnJhaW4vYnJhaW4ubW9kdWxlLnRzIiwic3JjL2phbml0b3IvamFuaXRvci5jb250cm9sbGVyLnRzIiwic3JjL2phbml0b3IvamFuaXRvci5tb2R1bGUudHMiLCJzcmMvbmF2YmFyL25hdmJhci5tb2R1bGUudHMiLCJzcmMvbm90ZS9ub3RlLmNvbnRyb2xsZXIudHMiLCJzcmMvbm90ZS9ub3RlLm1vZHVsZS50cyIsInNyYy9wb3VjaGRiL3BvdWNoZGIuZGVzaWduLnRzIiwic3JjL3BvdWNoZGIvcG91Y2hkYi5tb2R1bGUudHMiLCJzcmMvcG91Y2hkYi9wb3VjaGRiLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7WUNFQSxRQUFBLGVBQUEsUUFBQSxjQUFBLE9BQUEsd0JBRUUsb0JBQ0EsaUJBQ0EscUJBRUEsU0FDRSxFQUNBLEVBQ0EsR0FHQSxFQUFrQixXQUFVLEdBRTVCLEVBQW1CLFVBQVUsS0FFN0IsRUFDQyxNQUFNLFNBQ0wsSUFBSyxJQUNMLFNBQVUsb0JBRVgsTUFBTSxXQUNMLFNBQVUsd0JBRVgsTUFBTSxRQUNMLFFBQ0UsS0FBTSxNQUVSLFNBQVU7OztZQzlCaEIsSUFBQSxlQUFBLFFBQW9CLGlCQUVwQixlQUFBLFFBQWtCLHdCQUNsQixpQkFBQSxRQUFvQiw0QkFDcEIsZ0JBQUEsUUFBbUIsMEJBQ25CLGNBQUEsUUFBaUIsc0JBQ2pCLGlCQUFBLFFBQW9CLDJCQUVwQixTQUFRLE9BQU8sWUFDYixZQUNBLGNBQ0EsZUFBQSxXQUNBLGlCQUFBLFdBQ0EsZ0JBQUEsV0FDQSxjQUFBLFdBQ0EsaUJBQUEsYUFFRCxPQUFPLGNBQUE7OztZQ0dSLElBQUEsaUJBQUEsV0FnQkUsUUFBQSxHQUNVLEVBQ0EsRUFDQSxFQUNBLEVBQ0Es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ZUFBQSxRQUFBLGNBQUEsT0FBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgeyBJTm90ZSB9IGZyb20gJy4vbm90ZS9ub3RlLm1vZHVsZSc7XG5cbmV4cG9ydCBkZWZhdWx0IFtcblxuICAnJGxvY2F0aW9uUHJvdmlkZXInLFxuICAnJHN0YXRlUHJvdmlkZXInLFxuICAnJHVybFJvdXRlclByb3ZpZGVyJyxcblxuICAoXG4gICAgJGxvY2F0aW9uUHJvdmlkZXI6IG5nLklMb2NhdGlvblByb3ZpZGVyLFxuICAgICRzdGF0ZVByb3ZpZGVyOiBuZy51aS5JU3RhdGVQcm92aWRlcixcbiAgICAkdXJsUm91dGVyUHJvdmlkZXI6IG5nLnVpLklVcmxSb3V0ZXJQcm92aWRlclxuICApID0+IHtcblxuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcblxuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgLnN0YXRlKCdicmFpbicsIHtcbiAgICAgIHVybDogJy8nLFxuICAgICAgdGVtcGxhdGU6ICc8YnJhaW4+PC9icmFpbj4nXG4gICAgfSlcbiAgICAuc3RhdGUoJ2phbml0b3InLCB7XG4gICAgICB0ZW1wbGF0ZTogJzxqYW5pdG9yPjwvamFuaXRvcj4nXG4gICAgfSlcbiAgICAuc3RhdGUoJ25vdGUnLCB7XG4gICAgICBwYXJhbXM6IHtcbiAgICAgICAgbm90ZTogbnVsbFxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPG5vdGU+PC9ub3RlPidcbiAgICB9KTtcblxuICB9XG5dO1xuXG5pbnRlcmZhY2UgSVN0YXRlUGFyYW1zIHtcbiAgbm90ZT86IElOb3RlO1xufTtcblxuZXhwb3J0IHsgSVN0YXRlUGFyYW1zIH1cbiIsImltcG9ydCByb3V0aW5nIGZyb20gJy4vYXBwLnJvdXRpbmcnO1xuXG5pbXBvcnQgYnJhaW4gZnJvbSAnLi9icmFpbi9icmFpbi5tb2R1bGUnO1xuaW1wb3J0IGphbml0b3IgZnJvbSAnLi9qYW5pdG9yL2phbml0b3IubW9kdWxlJztcbmltcG9ydCBuYXZiYXIgZnJvbSAnLi9uYXZiYXIvbmF2YmFyLm1vZHVsZSc7XG5pbXBvcnQgbm90ZSBmcm9tICcuL25vdGUvbm90ZS5tb2R1bGUnO1xuaW1wb3J0IHBvdWNoZGIgZnJvbSAnLi9wb3VjaGRiL3BvdWNoZGIubW9kdWxlJztcblxuYW5ndWxhci5tb2R1bGUoJ3NoZXJsb2NrJywgW1xuICAndWkucm91dGVyJyxcbiAgJ25nVGFnc0lucHV0JyxcbiAgYnJhaW4sXG4gIGphbml0b3IsXG4gIG5hdmJhcixcbiAgbm90ZSxcbiAgcG91Y2hkYlxuXSlcbi5jb25maWcocm91dGluZyk7XG4iLCJpbXBvcnQgcG91Y2hkYlNlcnZpY2UgZnJvbSAnLi4vcG91Y2hkYi9wb3VjaGRiLnNlcnZpY2UnO1xuaW1wb3J0IHsgSU5vdGUgfSBmcm9tICcuLi9ub3RlL25vdGUubW9kdWxlJztcblxuaW50ZXJmYWNlIExldmVsVGFnIHtcbiAgdGFnOiBzdHJpbmc7XG4gIG5vdGVzOiBMZXZlbE5vdGVbXTtcbn1cblxuaW50ZXJmYWNlIExldmVsTm90ZSB7XG4gIF9pZDogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICB0YWdzOiBzdHJpbmdbXTtcbn1cblxuaW50ZXJmYWNlIExldmVsIHtcbiAgc2VsZWN0ZWRUYWc6IHN0cmluZztcbiAgdGFnczogTGV2ZWxUYWdbXTtcbiAgbm90ZXM6IExldmVsTm90ZVtdO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCcmFpbkNvbnRyb2xsZXIge1xuXG4gIGxldmVsczogTGV2ZWxbXTtcbiAgbm90ZTogSU5vdGU7XG5cbiAgc3RhdGljICRpbmplY3QgPSBbXG4gICAgJyRkb2N1bWVudCcsXG4gICAgJyRlbGVtZW50JyxcbiAgICAnJGxvZycsXG4gICAgJ3BvdWNoZGInLFxuICAgICckc2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICckdGltZW91dCcsXG4gICAgJyR3aW5kb3cnXG4gIF07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSAkZG9jdW1lbnQ6IG5nLklEb2N1bWVudFNlcnZpY2UsXG4gICAgcHJpdmF0ZSAkZWxlbWVudDogbmcuSUF1Z21lbnRlZEpRdWVyeSxcbiAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgcG91Y2hkYjogcG91Y2hkYlNlcnZpY2UsXG4gICAgcHJpdmF0ZSAkc2NvcGU6IG5nLklTY29wZSxcbiAgICBwcml2YXRlICRzdGF0ZTogbmcudWkuSVN0YXRlU2VydmljZSxcbiAgICBwcml2YXRlICR0aW1lb3V0OiBuZy5JVGltZW91dFNlcnZpY2UsXG4gICAgcHJpdmF0ZSAkd2luZG93OiBuZy5JV2luZG93U2VydmljZVxuICApIHtcblxuICAgIHRoaXMubm90ZSA9IG51bGw7XG5cbiAgICAvLyBCdWlsZCBsZXZlbCAwXG5cbiAgICB0aGlzLmxldmVscyA9IFt7XG4gICAgICBzZWxlY3RlZFRhZzogbnVsbCxcbiAgICAgIHRhZ3M6IG51bGwsXG4gICAgICBub3RlczogbnVsbFxuICAgIH1dO1xuXG4gICAgLy8gQWxsIHRhZ3NcblxuICAgIHRoaXMucG91Y2hkYi5nZXRBbGxUYWdzKClcbiAgICAudGhlbigodGFnczogTGV2ZWxUYWdbXSkgPT4ge1xuICAgICAgdGhpcy5sZXZlbHNbMF0udGFncyA9IHRhZ3M7XG4gICAgfSk7XG5cbiAgICAvLyBBbGwgbm90ZXMgd2l0aCB6ZXJvIHRhZ3NcblxuICAgIHRoaXMucG91Y2hkYi5nZXROb3Rlc1dpdGhUYWcobnVsbClcbiAgICAudGhlbigobGV2ZWxOb3RlczogTGV2ZWxOb3RlW10pID0+IHtcbiAgICAgIHRoaXMubGV2ZWxzWzBdLm5vdGVzID0gbGV2ZWxOb3Rlc1xuICAgIH0pO1xuXG4gIH1cblxuICAkb25Jbml0KCkge1xuICAgIHRoaXMuJGxvZy5kZWJ1ZygnSW5pdGlhbGl6aW5nIGJyYWluIGNvbXBvbmVudCcpO1xuICAgIHRoaXMuJHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnRyYW5zbGF0ZSwgZmFsc2UpO1xuICB9XG5cbiAgJG9uRGVzdHJveSgpIHtcbiAgICB0aGlzLiRsb2cuZGVidWcoJ0Rlc3Ryb3lpbmcgYnJhaW4gY29tcG9uZW50Jyk7XG4gICAgdGhpcy4kd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMudHJhbnNsYXRlLCBmYWxzZSk7XG4gIH1cblxuICBvblRpdGxlTW91c2VlbnRlcihsZXZlbE51bWJlcjogbnVtYmVyLCBsZXZlbE5vdGU6IExldmVsTm90ZSkge1xuICAgIHRoaXMub3Blbk5vdGUobGV2ZWxOb3RlLl9pZCk7XG4gICAgdGhpcy5hc3NlcnRMZXZlbChsZXZlbE51bWJlcik7XG4gICAgdGhpcy5sZXZlbHNbbGV2ZWxOdW1iZXJdLnNlbGVjdGVkVGFnID0gbnVsbDtcbiAgfVxuXG4gIG9wZW5Ob3RlKG5vdGVJZDogc3RyaW5nKSB7XG4gICAgdGhpcy4kbG9nLmRlYnVnKCdvcGVuaW5nIG5vdGUnKTtcbiAgICB0aGlzLnBvdWNoZGIuZ2V0KG5vdGVJZClcbiAgICAudGhlbigobm90ZTogSU5vdGUpID0+IHtcbiAgICAgIHRoaXMubm90ZSA9IG5vdGU7XG4gICAgICB0aGlzLnRyYW5zbGF0ZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgY2xvc2VOb3RlKCkge1xuICAgIGlmICh0aGlzLm5vdGUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy4kbG9nLmRlYnVnKCdjbG9zaW5nIG5vdGUnKTtcbiAgICB0aGlzLm5vdGUgPSBudWxsO1xuICAgIHRoaXMudHJhbnNsYXRlKCk7XG4gIH1cblxuICAvLyBCdWlsZCB0aGUgbmV4dCBsZXZlbCBvZiB0YWdzIGFuZCBub3Rlc1xuICAvLyBiYXNlZCBvbiB0aGUgY3VycmVudCBsZXZlbCBhbmQgYSB0YWcuXG4gIG9uVGFnTW91c2VlbnRlcihsZXZlbE51bWJlcjogbnVtYmVyLCBsZXZlbFRhZzogTGV2ZWxUYWcpIHtcbiAgICB0aGlzLmNsb3NlTm90ZSgpO1xuICAgIHRoaXMuYXNzZXJ0TGV2ZWwobGV2ZWxOdW1iZXIpO1xuICAgIHRoaXMubGV2ZWxzW2xldmVsTnVtYmVyXS5zZWxlY3RlZFRhZyA9IGxldmVsVGFnLnRhZztcblxuICAgIHZhciBpbnB1dFRhZ3MgPSB0aGlzLmxldmVscy5tYXAoKGxldmVsKSA9PiB7XG4gICAgICByZXR1cm4gbGV2ZWwuc2VsZWN0ZWRUYWc7XG4gICAgfSk7XG5cbiAgICBpZiAobGV2ZWxUYWcubm90ZXMgPT09IG51bGwpIHtcbiAgICAgIHRoaXMucG91Y2hkYi5nZXROb3Rlc1dpdGhUYWcobGV2ZWxUYWcudGFnKVxuICAgICAgLnRoZW4oKGxldmVsTm90ZXM6IExldmVsTm90ZVtdKSA9PiB7XG4gICAgICAgIHRoaXMuYnVpbGROZXh0TGV2ZWwobGV2ZWxOb3RlcywgaW5wdXRUYWdzKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuYnVpbGROZXh0TGV2ZWwobGV2ZWxUYWcubm90ZXMsIGlucHV0VGFncyk7XG4gICAgfVxuICB9XG5cbiAgYnVpbGROZXh0TGV2ZWwobGV2ZWxOb3RlczogTGV2ZWxOb3RlW10sIGlucHV0VGFnczogc3RyaW5nW10pIHtcbiAgICAvLyBwcm9jZXNzIGFsbCBsZXZlbE5vdGVzXG5cbiAgICB2YXIgdGFnTm90ZXM6IHtbdGFnOiBzdHJpbmddOiBMZXZlbE5vdGVbXX0gPSB7fTtcbiAgICB2YXIgbm90ZXM6IExldmVsTm90ZVtdID0gW107XG5cbiAgICAvLyBvbmUgbm90ZSBwZXIgcm93XG4gICAgbGV2ZWxOb3Rlcy5mb3JFYWNoKChsZXZlbE5vdGUpID0+IHtcbiAgICAgIHZhciBpbnRlcnNlY3Rpb24gPSBfLmludGVyc2VjdGlvbihpbnB1dFRhZ3MsIGxldmVsTm90ZS50YWdzKTtcblxuICAgICAgLy8gZXhhY3QgbWF0Y2gsIHNob3cgaXQgYXMgYSBub3RlLlxuICAgICAgaWYgKGludGVyc2VjdGlvbi5sZW5ndGggPT09IGxldmVsTm90ZS50YWdzLmxlbmd0aCkge1xuICAgICAgICBub3Rlcy5wdXNoKGxldmVsTm90ZSk7XG4gICAgICB9XG4gICAgICAvLyBwYXJ0aWFsIG1hdGNoOyBpbmNsdWRlIGl0IHVuZGVyIHRhZ3NcbiAgICAgIGVsc2UgaWYgKGludGVyc2VjdGlvbi5sZW5ndGggPT09IGlucHV0VGFncy5sZW5ndGgpIHtcbiAgICAgICAgbGV2ZWxOb3RlLnRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgICAgaWYgKF8uaW5jbHVkZXMoaW5wdXRUYWdzLCB0YWcpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghdGFnTm90ZXNbdGFnXSkge1xuICAgICAgICAgICAgdGFnTm90ZXNbdGFnXSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0YWdOb3Rlc1t0YWddLnB1c2gobGV2ZWxOb3RlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBjb252ZXJ0IHRhZyBtYXAgaW50byBsaXN0XG5cbiAgICB2YXIgbGV2ZWxUYWdzID0gT2JqZWN0LmtleXModGFnTm90ZXMpLm1hcCgodGFnKT0+e1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFnOiB0YWcsXG4gICAgICAgIG5vdGVzOiA8TGV2ZWxOb3RlW10+IHRhZ05vdGVzW3RhZ11cbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICB2YXIgdGFncyA9IF8uc29ydEJ5KGxldmVsVGFncywgJ3RhZycpO1xuXG4gICAgdGhpcy5sZXZlbHMucHVzaCh7XG4gICAgICBzZWxlY3RlZFRhZzogbnVsbCxcbiAgICAgIHRhZ3M6IHRhZ3MsXG4gICAgICBub3Rlczogbm90ZXNcbiAgICB9KTtcblxuICAgIHRoaXMudHJhbnNsYXRlKCk7XG4gIH1cblxuICAvLyByZW1vdmUgbGV2ZWxzIGFib3ZlIG5cbiAgYXNzZXJ0TGV2ZWwobjogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMubGV2ZWxzLmxlbmd0aCAtIDEgPD0gbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLiRsb2cuZGVidWcoJ0Fzc2VydCBsZXZlbCAnLCBuKTtcbiAgICB0aGlzLmxldmVscy5zcGxpY2UobiArIDEsIHRoaXMubGV2ZWxzLmxlbmd0aCk7XG4gICAgdGhpcy50cmFuc2xhdGUoKTtcbiAgfVxuXG4gIG9uTGV2ZWxNb3VzZW92ZXIoZXZlbnQ6IEpRdWVyeU1vdXNlRXZlbnRPYmplY3QsIGxldmVsTnVtYmVyOiBudW1iZXIpIHtcbiAgICB0aGlzLmNsb3NlTm90ZSgpO1xuICAgIHRoaXMuYXNzZXJ0TGV2ZWwobGV2ZWxOdW1iZXIpO1xuICAgIHRoaXMubGV2ZWxzW2xldmVsTnVtYmVyXS5zZWxlY3RlZFRhZyA9IG51bGw7XG4gIH1cblxuICB0cmFuc2xhdGUgPSAoKSA9PiB7XG4gICAgdGhpcy4kdGltZW91dCgoKSA9PiB7XG4gICAgICAvLyBsZXZlbCB3aWR0aHMgKyBub3RlIHdpZHRoXG4gICAgICB2YXIgY29udGVudFdpZHRoID0gdGhpcy5jYWxjdWxhdGVXaWR0aCgnYnJhaW4gLmxldmVsJykgKyB0aGlzLmNhbGN1bGF0ZVdpZHRoKCdicmFpbiAubm90ZScpO1xuICAgICAgdmFyIG91dGVyV2lkdGggPSB0aGlzLmNhbGN1bGF0ZUVsZW1lbnRXaWR0aCh0aGlzLiRlbGVtZW50WzBdKTtcbiAgICAgIHZhciBkaWZmID0gTWF0aC5tYXgoMCwgY29udGVudFdpZHRoIC0gb3V0ZXJXaWR0aCk7XG4gICAgICB2YXIgdHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVgoLScgKyBkaWZmICsgJ3B4KSc7XG4gICAgICB0aGlzLiRlbGVtZW50LmNzcyh7XG4gICAgICAgIHdlYmtpdFRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgICBNb3pUcmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgICAgbXNUcmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgICAgT1RyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybVxuICAgICAgfSk7XG4gICAgICB0aGlzLiRsb2cuZGVidWcoJ1RyYW5zbGF0aW5nICVzIHBpeGVscyB0byB0aGUgbGVmdCcsIGRpZmYpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVXaWR0aChzZWxlY3Rvcjogc3RyaW5nKSB7XG4gICAgdmFyIHN1bSA9IDA7XG4gICAgdmFyIGVsZW1lbnRzID0gdGhpcy4kZG9jdW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgc3VtICs9IHRoaXMuY2FsY3VsYXRlRWxlbWVudFdpZHRoKGVsZW1lbnRzLml0ZW0oaSkpO1xuICAgIH1cbiAgICByZXR1cm4gc3VtO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVFbGVtZW50V2lkdGgoZWxlbWVudDogRWxlbWVudCkge1xuICAgIHZhciB3aWR0aCA9IHRoaXMuJHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpLmdldFByb3BlcnR5VmFsdWUoJ3dpZHRoJyk7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQod2lkdGgpO1xuICB9XG5cbiAgZWRpdE5vdGUoKSB7XG4gICAgdGhpcy4kc3RhdGUuZ28oJ25vdGUnLCB7bm90ZTogdGhpcy5ub3RlfSk7XG4gIH1cblxufVxuIiwiaW1wb3J0IEJyYWluQ29udHJvbGxlciBmcm9tICcuL2JyYWluLmNvbnRyb2xsZXInO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyXG4ubW9kdWxlKCdzaGVybG9jay5icmFpbicsIFtdKVxuLmNvbXBvbmVudCgnYnJhaW4nLCB7XG4gIHRlbXBsYXRlVXJsOiAnc3JjL2JyYWluL2JyYWluLnRlbXBsYXRlLmh0bWwnLFxuICBjb250cm9sbGVyOiBCcmFpbkNvbnRyb2xsZXJcbn0pXG4ubmFtZTtcbiIsImltcG9ydCBwb3VjaGRiU2VydmljZSBmcm9tICcuLi9wb3VjaGRiL3BvdWNoZGIuc2VydmljZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEphbml0b3JDb250cm9sbGVyIHtcblxuICBub3RlczogYW55W107XG5cbiAgc3RhdGljICRpbmplY3QgPSBbJyRsb2cnLCdwb3VjaGRiJywnJHN0YXRlJywnJHdpbmRvdyddO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBwb3VjaGRiOiBwb3VjaGRiU2VydmljZSxcbiAgICBwcml2YXRlICRzdGF0ZTogbmcudWkuSVN0YXRlU2VydmljZSxcbiAgICBwcml2YXRlICR3aW5kb3c6IG5nLklXaW5kb3dTZXJ2aWNlXG4gICkge1xuXG4gICAgdGhpcy5nZXRBbGxOb3RlcygpO1xuXG4gIH1cblxuICB0b0pzb24ob2JqOiBhbnkpOiBzdHJpbmcge1xuICAgIHJldHVybiBhbmd1bGFyLnRvSnNvbihvYmosIHRydWUpO1xuICB9XG5cbiAgZ2V0QWxsTm90ZXMoKSB7XG5cbiAgICB0aGlzLnBvdWNoZGIuYWxsTm90ZXMoKVxuICAgIC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICB0aGlzLiRsb2cuZGVidWcoJ2FsbE5vdGVzIHJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgICAgdGhpcy5ub3RlcyA9IHJlc3BvbnNlLnJvd3MubWFwKChyb3c6IGFueSkgPT4ge1xuICAgICAgICByZXR1cm4gcm93LmRvYztcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgLmNhdGNoKHRoaXMuJGxvZy5lcnJvcik7XG5cbiAgfVxuXG4gIGRlbGV0ZUFsbE5vdGVzKCkge1xuXG4gICAgaWYgKCF0aGlzLiR3aW5kb3cuY29uZmlybSgnUmVhbGx5IGRlbGV0ZSBhbGwgbm90ZXM/JykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLiRsb2cuZGVidWcoJ0RlbGV0aW5nIGFsbCBub3RlcycpO1xuXG4gICAgdmFyIGRlbGV0ZWROb3RlcyA9IHRoaXMubm90ZXMubWFwKChub3RlOiBhbnkpID0+IHtcbiAgICAgIG5vdGUuX2RlbGV0ZWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIG5vdGU7XG4gICAgfSk7XG5cbiAgICB0aGlzLnBvdWNoZGIuYnVsa0RvY3MoZGVsZXRlZE5vdGVzKVxuICAgIC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICB0aGlzLiRsb2cuZGVidWcoJ2J1bGtEb2NzIHJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgICAgdGhpcy5ub3RlcyA9IFtdO1xuICAgIH0pXG4gICAgLmNhdGNoKHRoaXMuJGxvZy5lcnJvcik7XG5cbiAgfVxuXG4gIGRlc3Ryb3lEYXRhYmFzZSgpIHtcblxuICAgIGlmICghdGhpcy4kd2luZG93LmNvbmZpcm0oJ1JlYWxseSBkZXN0cm95IGRhdGFiYXNlPycpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy4kbG9nLmRlYnVnKCdEZXN0cm95aW5nIGRhdGFiYXNlJyk7XG5cbiAgICB0aGlzLnBvdWNoZGIuZGVzdHJveSgpLnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgIHRoaXMuJGxvZy5kZWJ1ZygnZGIgZGVzdHJveWVkIHJlc3BvbnNlJyxyZXNwb25zZSk7XG4gICAgICB0aGlzLm5vdGVzID0gW107XG4gICAgfSk7XG5cbiAgfVxuXG4gIGdvVG9Ob3RlKG5vdGU6IGFueSkge1xuICAgIHRoaXMuJHN0YXRlLmdvKCdub3RlJywge1xuICAgICAgbm90ZTogbm90ZVxuICAgIH0pO1xuICB9XG5cbn1cbiIsImltcG9ydCBKYW5pdG9yQ29udHJvbGxlciBmcm9tICcuL2phbml0b3IuY29udHJvbGxlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGFuZ3VsYXJcbi5tb2R1bGUoJ3NoZXJsb2NrLmphbml0b3InLCBbXSlcbi5jb21wb25lbnQoJ2phbml0b3InLCB7XG4gIHRlbXBsYXRlVXJsOiAnc3JjL2phbml0b3IvamFuaXRvci50ZW1wbGF0ZS5odG1sJyxcbiAgY29udHJvbGxlcjogSmFuaXRvckNvbnRyb2xsZXJcbn0pXG4ubmFtZTtcbiIsImV4cG9ydCBkZWZhdWx0IGFuZ3VsYXJcbi5tb2R1bGUoJ3NoZXJsb2NrLm5hdmJhcicsIFtdKVxuLmNvbXBvbmVudCgnbmF2YmFyJywge1xuICB0ZW1wbGF0ZVVybDogJ3NyYy9uYXZiYXIvbmF2YmFyLnRlbXBsYXRlLmh0bWwnXG59KVxuLm5hbWU7XG4iLCJpbXBvcnQgcG91Y2hkYlNlcnZpY2UgZnJvbSAnLi4vcG91Y2hkYi9wb3VjaGRiLnNlcnZpY2UnO1xuaW1wb3J0IHsgSVN0YXRlUGFyYW1zIH0gZnJvbSAnLi4vYXBwLnJvdXRpbmcnO1xuaW1wb3J0IHsgSU5vdGUgfSBmcm9tICcuL25vdGUubW9kdWxlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTm90ZUNvbnRyb2xsZXIge1xuXG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdGFnczoge3RleHQ6IHN0cmluZ31bXTtcblxuICBzdGF0aWMgJGluamVjdCA9IFsnJGxvZycsJ3BvdWNoZGInLCckc3RhdGVQYXJhbXMnLCckd2luZG93J107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSAkbG9nOiBuZy5JTG9nU2VydmljZSxcbiAgICBwcml2YXRlIHBvdWNoZGI6IHBvdWNoZGJTZXJ2aWNlLFxuICAgIHByaXZhdGUgJHN0YXRlUGFyYW1zOiBJU3RhdGVQYXJhbXMsXG4gICAgcHJpdmF0ZSAkd2luZG93OiBuZy5JV2luZG93U2VydmljZVxuICApIHtcbiAgICB0aGlzLnNldE5vdGVTdGF0ZSgpO1xuICB9XG5cbiAgc2V0Tm90ZVN0YXRlKCkge1xuICAgIGlmICh0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlKSB7XG4gICAgICB0aGlzLnRpdGxlID0gdGhpcy4kc3RhdGVQYXJhbXMubm90ZS50aXRsZTtcbiAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUuY29udGVudDtcbiAgICAgIHRoaXMudGFncyA9IHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUudGFncy5tYXAoKHRhZykgPT4ge1xuICAgICAgICByZXR1cm4ge3RleHQ6IHRhZ307XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnRpdGxlID0gJyc7XG4gICAgICB0aGlzLmNvbnRlbnQgPSAnJztcbiAgICAgIHRoaXMudGFncyA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIHB1dE5vdGUoKSB7XG5cbiAgICBsZXQgbm90ZUlkOiBzdHJpbmc7XG4gICAgaWYgKHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUpIHtcbiAgICAgIG5vdGVJZCA9IHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUuX2lkO1xuICAgIH1cblxuICAgIHZhciB0YWdzID0gdGhpcy50YWdzLm1hcCgodGFnKSA9PiB7IHJldHVybiB0YWcudGV4dDsgfSk7XG5cbiAgICBsZXQgbm90ZTogSU5vdGUgPSB7XG4gICAgICBfaWQ6IG5vdGVJZCB8fCB0aGlzLmNyZWF0ZU5vdGVJZCgpLFxuICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICBjb250ZW50OiB0aGlzLmNvbnRlbnQsXG4gICAgICB0YWdzOiB0YWdzXG4gICAgfTtcblxuICAgIGlmICh0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlKSB7XG4gICAgICBub3RlLl9yZXYgPSB0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlLl9yZXY7XG4gICAgfVxuXG4gICAgdGhpcy5wb3VjaGRiLnB1dChub3RlKVxuICAgIC50aGVuKChyZXNwb25zZTogUG91Y2hVcGRhdGVSZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy4kbG9nLmluZm8ocmVzcG9uc2UpO1xuICAgICAgbm90ZS5fcmV2ID0gcmVzcG9uc2UucmV2O1xuICAgICAgdGhpcy4kc3RhdGVQYXJhbXMubm90ZSA9IG5vdGU7Ly8hXG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yOiBQb3VjaFVwZGF0ZUVycm9yKSA9PiB7XG4gICAgICB0aGlzLiRsb2cuZXJyb3IoJ3B1dCBub3RlIGVycm9yJywgZXJyb3IpO1xuICAgIH0pO1xuXG4gIH1cblxuICBkZWxldGVOb3RlKCkge1xuXG4gICAgaWYgKCF0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLiR3aW5kb3cuY29uZmlybSgnUmVhbGx5IGRlbGV0ZSBub3RlPycpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy4kc3RhdGVQYXJhbXMubm90ZS5fZGVsZXRlZCA9IHRydWU7XG5cbiAgICB0aGlzLnBvdWNoZGIucHV0KHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUpXG4gICAgLnRoZW4oKHJlc3BvbnNlOiBQb3VjaFVwZGF0ZVJlc3BvbnNlKSA9PiB7XG4gICAgICB0aGlzLiRsb2cuaW5mbyhyZXNwb25zZSk7XG4gICAgICB0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlID0gbnVsbDsvLyFcbiAgICAgIHRoaXMuc2V0Tm90ZVN0YXRlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yOiBQb3VjaFVwZGF0ZUVycm9yKSA9PiB7XG4gICAgICB0aGlzLiRsb2cuZXJyb3IoJ2RlbCBub3RlIGVycm9yJywgZXJyb3IpO1xuICAgIH0pO1xuXG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU5vdGVJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiAnbm90ZScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKS50b1N0cmluZygpO1xuICB9XG5cbn1cbiIsImltcG9ydCBOb3RlQ29udHJvbGxlciBmcm9tICcuL25vdGUuY29udHJvbGxlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGFuZ3VsYXJcbi5tb2R1bGUoJ3NoZXJsb2NrLm5vdGUnLCBbXSlcbi5jb21wb25lbnQoJ25vdGUnLCB7XG4gIHRlbXBsYXRlVXJsOiAnc3JjL25vdGUvbm90ZS50ZW1wbGF0ZS5odG1sJyxcbiAgY29udHJvbGxlcjogTm90ZUNvbnRyb2xsZXJcbn0pXG4ubmFtZTtcblxuaW50ZXJmYWNlIElOb3RlIHtcbiAgX2lkOiBzdHJpbmc7XG4gIF9yZXY/OiBzdHJpbmc7XG4gIF9kZWxldGVkPzogYm9vbGVhbjtcbiAgdGl0bGU6IHN0cmluZztcbiAgY29udGVudDogc3RyaW5nO1xuICB0YWdzOiBzdHJpbmdbXTtcbn1cblxuaW50ZXJmYWNlIElOb3RlUGFydGlhbCB7XG4gIF9pZDogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICB0YWdzOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IHsgSU5vdGUsIElOb3RlUGFydGlhbCB9XG4iLCIvLyBkZXNpZ24gZG9jXG4vLyBlbWl0IGVhY2ggdGFnIGFzIGtleVxuLy8gZW1pdCB0aXRsZSBhcyB2YWx1ZVxuXG5pbXBvcnQgeyBJTm90ZSB9IGZyb20gJy4uL25vdGUvbm90ZS5tb2R1bGUnO1xuXG5leHBvcnQgZGVmYXVsdCB7XG5cbiAgX2lkOiAnX2Rlc2lnbi90YWdzJyxcblxuICB2aWV3czoge1xuICAgIHRhZ3M6IHtcblxuICAgICAgbWFwOiBmdW5jdGlvbiAoZG9jOiBJTm90ZSkge1xuICAgICAgICBpZiAoZG9jLnRhZ3MpIHtcbiAgICAgICAgICBpZiAoZG9jLnRhZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBlbWl0KG51bGwsIHt0aXRsZTogZG9jLnRpdGxlLCB0YWdzOiBbXX0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLnRhZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgZW1pdChkb2MudGFnc1tpXSwge3RpdGxlOiBkb2MudGl0bGUsIHRhZ3M6IGRvYy50YWdzfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LnRvU3RyaW5nKCksXG5cbiAgICAgIHJlZHVjZTogJ19jb3VudCdcblxuICAgIH1cbiAgfVxuXG59XG4iLCJpbXBvcnQgcG91Y2hkYiBmcm9tICcuL3BvdWNoZGIuc2VydmljZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGFuZ3VsYXJcbi5tb2R1bGUoJ3NoZXJsb2NrLnBvdWNoZGInLCBbXSlcbi5zZXJ2aWNlKCdwb3VjaGRiJywgcG91Y2hkYilcbi5uYW1lO1xuIiwiaW1wb3J0IGRlc2lnbiBmcm9tICcuL3BvdWNoZGIuZGVzaWduJztcbmltcG9ydCB7IElOb3RlLCBJTm90ZVBhcnRpYWwgfSBmcm9tICcuLi9ub3RlL25vdGUubW9kdWxlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgcG91Y2hkYiB7XG5cbiAgcHJpdmF0ZSBkYjogUG91Y2hEQjtcblxuICBzdGF0aWMgJGluamVjdCA9IFtcbiAgICAnJGxvZycsXG4gICAgJyRxJ1xuICBdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSAkcTogbmcuSVFTZXJ2aWNlXG4gICkge1xuXG4gICAgdGhpcy5kYiA9IG5ldyBQb3VjaERCKCdzaGVybG9jaycpO1xuXG4gICAgLy8gUmVwbGljYXRlIGZyb20gc2VydmVyXG5cbiAgICAvLyBJbmRleCB0YWdzXG4gICAgdGhpcy5kYi5wdXQoZGVzaWduKVxuICAgIC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAkbG9nLmRlYnVnKCdkZXNpZ24gZG9jIHJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgIH0pLmNhdGNoKChlcnJvcjogYW55KSA9PiB7XG4gICAgICAvLyBjb25mbGljdCBvaz9cbiAgICAgIGlmIChlcnJvci5uYW1lICE9PSAnY29uZmxpY3QnKSB7XG4gICAgICAgIHRoaXMuJGxvZy5lcnJvcihlcnJvcik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfVxuXG4gIGdldChpZDogc3RyaW5nKTogbmcuSVByb21pc2U8YW55PiB7XG4gICAgLy8gd2FpdCBmb3IgaW5kZXggcHJvbWlzZT9cbiAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHRoaXMuZGIuZ2V0KGlkKSk7XG4gIH1cblxuICBwdXQoZG9jOiBhbnkpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICAvLyB3YWl0IGZvciBpbmRleCBwcm9taXNlP1xuICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUodGhpcy5kYi5wdXQoZG9jKSk7XG4gIH1cblxuICBhbGxEb2NzKG9wdGlvbnM6IFBvdWNoQWxsRG9jc09wdGlvbnMpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICAvLyB3YWl0IGZvciBpbmRleCBwcm9taXNlP1xuICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUodGhpcy5kYi5hbGxEb2NzKG9wdGlvbnMpKTtcbiAgfVxuXG4gIGFsbE5vdGVzKCk6IG5nLklQcm9taXNlPGFueT4ge1xuICAgIC8vIHdhaXQgZm9yIGluZGV4IHByb21pc2U/XG5cbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgIHN0YXJ0a2V5OiAnbm90ZScsXG4gICAgICBlbmRrZXk6ICdub3RlXFx1ZmZmMCcsXG4gICAgICBpbmNsdWRlX2RvY3M6IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUodGhpcy5kYi5hbGxEb2NzKG9wdGlvbnMpKTtcbiAgfVxuXG4gIGJ1bGtEb2NzKGRvY3M6IGFueVtdKTogbmcuSVByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZSh0aGlzLmRiLmJ1bGtEb2NzKGRvY3MpKTtcbiAgfVxuXG4gIHF1ZXJ5KHZpZXdOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IGFueSk6IG5nLklQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUodGhpcy5kYi5xdWVyeSh2aWV3TmFtZSwgb3B0aW9ucykpO1xuICB9XG5cbiAgZGVzdHJveSgpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHRoaXMuZGIuZGVzdHJveSgpKTtcbiAgfVxuXG4gIC8vIEdldCBub3RlcyB3aXRoIHNwZWNpZmllZCB0YWcuXG4gIC8vIChjb250ZW50IGV4Y2x1ZGVkIGZyb20gbm90ZXMpXG4gIGdldE5vdGVzV2l0aFRhZyh0YWc6IHN0cmluZyk6IG5nLklQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLnF1ZXJ5KCd0YWdzJywge1xuICAgICAgcmVkdWNlOiBmYWxzZSxcbiAgICAgIGtleTogdGFnXG4gICAgfSlcbiAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgdGhpcy4kbG9nLmluZm8oJ25vdGUgcXVlcnkgcmVzcG9uc2UnLCByZXNwb25zZSk7XG4gICAgICAvLyBvbmUgbm90ZSBwZXIgcm93XG4gICAgICByZXR1cm4gcmVzcG9uc2Uucm93cy5tYXAoKHJvdzogUG91Y2hRdWVyeVJvdykgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIF9pZDogcm93LmlkLFxuICAgICAgICAgIHRpdGxlOiByb3cudmFsdWUudGl0bGUsXG4gICAgICAgICAgdGFnczogcm93LnZhbHVlLnRhZ3NcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgLmNhdGNoKHRoaXMuJGxvZy5lcnJvcik7XG4gIH1cblxuICBnZXRBbGxUYWdzKCk6IG5nLklQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLnF1ZXJ5KCd0YWdzJywge1xuICAgICAgcmVkdWNlOiB0cnVlLFxuICAgICAgZ3JvdXA6IHRydWVcbiAgICB9KVxuICAgIC50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICB0aGlzLiRsb2cuaW5mbygndGFnIHF1ZXJ5IHJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgICAgLy8gb25lIHRhZyBwZXIgcm93XG4gICAgICByZXR1cm4gcmVzcG9uc2Uucm93c1xuICAgICAgLmZpbHRlcigocm93OiBQb3VjaFF1ZXJ5Um93KT0+e1xuICAgICAgICByZXR1cm4gcm93LmtleSAhPT0gbnVsbDtcbiAgICAgIH0pXG4gICAgICAubWFwKChyb3c6IFBvdWNoUXVlcnlSb3cpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0YWc6IHJvdy5rZXksXG4gICAgICAgICAgbm90ZXM6IDxJTm90ZVBhcnRpYWw+IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgLmNhdGNoKHRoaXMuJGxvZy5lcnJvcik7XG4gIH1cblxufVxuIl19
