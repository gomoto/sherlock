(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=["$locationProvider","$stateProvider","$urlRouterProvider",function(t,e,r){t.html5Mode(!0),r.otherwise("/"),e.state("brain",{url:"/",template:"<brain></brain>"}).state("janitor",{template:"<janitor></janitor>"}).state("note",{params:{note:null},template:"<note></note>"})}];

},{}],2:[function(require,module,exports){
"use strict";var app_routing_1=require("./app.routing"),brain_module_1=require("./brain/brain.module"),janitor_module_1=require("./janitor/janitor.module"),navbar_module_1=require("./navbar/navbar.module"),note_module_1=require("./note/note.module"),pouchdb_module_1=require("./pouchdb/pouchdb.module");angular.module("sherlock",["ui.router",brain_module_1["default"],janitor_module_1["default"],navbar_module_1["default"],note_module_1["default"],pouchdb_module_1["default"]]).config(app_routing_1["default"]);

},{"./app.routing":1,"./brain/brain.module":4,"./janitor/janitor.module":6,"./navbar/navbar.module":7,"./note/note.module":9,"./pouchdb/pouchdb.module":11}],3:[function(require,module,exports){
"use strict";var BrainController=function(){function t(t,e,n,o,s,l,i,a){var r=this;this.$document=t,this.$element=e,this.$log=n,this.pouchdb=o,this.$scope=s,this.$state=l,this.$timeout=i,this.$window=a,this.translate=function(){r.$timeout(function(){var t=r.calculateWidth("brain .level")+r.calculateWidth("brain .note"),e=r.calculateElementWidth(r.$element[0]),n=Math.max(0,t-e),o="translateX(-"+n+"px)";r.$element.css({webkitTransform:o,MozTransform:o,msTransform:o,OTransform:o,transform:o}),r.$log.debug("Translating %s pixels to the left",n)})},this.note=null,this.levels=[{selectedTag:null,tags:null,notes:null}],this.pouchdb.getAllTags().then(function(t){r.levels[0].tags=t}),this.pouchdb.getNotesWithTag(null).then(function(t){r.levels[0].notes=t})}return t.prototype.$onInit=function(){this.$log.debug("Initializing brain component"),this.$window.addEventListener("resize",this.translate,!1)},t.prototype.$onDestroy=function(){this.$log.debug("Destroying brain component"),this.$window.removeEventListener("resize",this.translate,!1)},t.prototype.onTitleMouseenter=function(t,e){this.openNote(e._id),this.assertLevel(t),this.levels[t].selectedTag=null},t.prototype.openNote=function(t){var e=this;this.$log.debug("opening note"),this.pouchdb.get(t).then(function(t){e.note=t,e.translate()})},t.prototype.closeNote=function(){null!==this.note&&(this.$log.debug("closing note"),this.note=null,this.translate())},t.prototype.onTagMouseenter=function(t,e){var n=this;this.closeNote(),this.assertLevel(t),this.levels[t].selectedTag=e.tag;var o=this.levels.map(function(t){return t.selectedTag});null===e.notes?this.pouchdb.getNotesWithTag(e.tag).then(function(t){n.buildNextLevel(t,o)}):this.buildNextLevel(e.notes,o)},t.prototype.buildNextLevel=function(t,e){var n={},o=[];t.forEach(function(t){var s=_.intersection(e,t.tags);s.length===t.tags.length?o.push(t):s.length===e.length&&t.tags.forEach(function(o){_.includes(e,o)||(n[o]||(n[o]=[]),n[o].push(t))})});var s=Object.keys(n).map(function(t){return{tag:t,notes:n[t]}}),l=_.sortBy(s,"tag");this.levels.push({selectedTag:null,tags:l,notes:o}),this.translate()},t.prototype.assertLevel=function(t){this.levels.length-1<=t||(this.$log.debug("Assert level ",t),this.levels.splice(t+1,this.levels.length),this.translate())},t.prototype.onLevelMouseover=function(t,e){this.closeNote(),this.assertLevel(e),this.levels[e].selectedTag=null},t.prototype.calculateWidth=function(t){for(var e=0,n=this.$document[0].querySelectorAll(t),o=0;o<n.length;o++)e+=this.calculateElementWidth(n.item(o));return e},t.prototype.calculateElementWidth=function(t){var e=this.$window.getComputedStyle(t).getPropertyValue("width");return parseFloat(e)},t.prototype.editNote=function(){this.$state.go("note",{note:this.note})},t.$inject=["$document","$element","$log","pouchdb","$scope","$state","$timeout","$window"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=BrainController;

},{}],4:[function(require,module,exports){
"use strict";var brain_controller_1=require("./brain.controller");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.brain",[]).component("brain",{templateUrl:"src/brain/brain.template.html",controller:brain_controller_1["default"]}).name;

},{"./brain.controller":3}],5:[function(require,module,exports){
"use strict";var JanitorController=function(){function t(t,o,e,n){this.$log=t,this.pouchdb=o,this.$state=e,this.$window=n,this.getAllNotes()}return t.prototype.toJson=function(t){return angular.toJson(t,!0)},t.prototype.getAllNotes=function(){var t=this;this.pouchdb.allNotes().then(function(o){t.$log.debug("allNotes response",o),t.notes=o.rows.map(function(t){return t.doc})})["catch"](this.$log.error)},t.prototype.deleteAllNotes=function(){var t=this;if(this.$window.confirm("Really delete all notes?")){this.$log.debug("Deleting all notes");var o=this.notes.map(function(t){return t._deleted=!0,t});this.pouchdb.bulkDocs(o).then(function(o){t.$log.debug("bulkDocs response",o),t.notes=[]})["catch"](this.$log.error)}},t.prototype.destroyDatabase=function(){var t=this;this.$window.confirm("Really destroy database?")&&(this.$log.debug("Destroying database"),this.pouchdb.destroy().then(function(o){t.$log.debug("db destroyed response",o),t.notes=[]}))},t.prototype.goToNote=function(t){this.$state.go("note",{note:t})},t.$inject=["$log","pouchdb","$state","$window"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=JanitorController;

},{}],6:[function(require,module,exports){
"use strict";var janitor_controller_1=require("./janitor.controller");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.janitor",[]).component("janitor",{templateUrl:"src/janitor/janitor.template.html",controller:janitor_controller_1["default"]}).name;

},{"./janitor.controller":5}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.navbar",[]).component("navbar",{templateUrl:"src/navbar/navbar.template.html"}).name;

},{}],8:[function(require,module,exports){
"use strict";var NoteController=function(){function t(t,e,o,s){this.$log=t,this.pouchdb=e,this.$stateParams=o,this.$window=s,this.setNoteState()}return t.prototype.setNoteState=function(){this.$stateParams.note?(this.title=this.$stateParams.note.title,this.content=this.$stateParams.note.content,this.tags=this.$stateParams.note.tags.join(",")):(this.title="",this.content="",this.tags="")},t.prototype.putNote=function(){var t,e=this;this.$stateParams.note&&(t=this.$stateParams.note._id);var o;o=0===this.tags.length?[]:this.tags.split(",");var s={_id:t||this.createNoteId(),title:this.title,content:this.content,tags:o};this.$stateParams.note&&(s._rev=this.$stateParams.note._rev),this.pouchdb.put(s).then(function(t){e.$log.info(t),s._rev=t.rev,e.$stateParams.note=s})["catch"](function(t){e.$log.error("put note error",t)})},t.prototype.deleteNote=function(){var t=this;this.$stateParams.note&&this.$window.confirm("Really delete note?")&&(this.$stateParams.note._deleted=!0,this.pouchdb.put(this.$stateParams.note).then(function(e){t.$log.info(e),t.$stateParams.note=null,t.setNoteState()})["catch"](function(e){t.$log.error("del note error",e)}))},t.prototype.createNoteId=function(){return"note"+(new Date).getTime().toString()},t.$inject=["$log","pouchdb","$stateParams","$window"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=NoteController;

},{}],9:[function(require,module,exports){
"use strict";var note_controller_1=require("./note.controller");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.note",[]).component("note",{templateUrl:"src/note/note.template.html",controller:note_controller_1["default"]}).name;

},{"./note.controller":8}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={_id:"_design/tags",views:{tags:{map:function(t){if(t.tags)if(0===t.tags.length)emit(null,{title:t.title,tags:[]});else for(var e=0;e<t.tags.length;e++)emit(t.tags[e],{title:t.title,tags:t.tags})}.toString(),reduce:"_count"}}};

},{}],11:[function(require,module,exports){
"use strict";var pouchdb_service_1=require("./pouchdb.service");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=angular.module("sherlock.pouchdb",[]).service("pouchdb",pouchdb_service_1["default"]).name;

},{"./pouchdb.service":12}],12:[function(require,module,exports){
"use strict";var pouchdb_design_1=require("./pouchdb.design"),pouchdb=function(){function t(t,e){var o=this;this.$log=t,this.$q=e,this.db=new PouchDB("sherlock"),this.db.put(pouchdb_design_1["default"]).then(function(e){t.debug("design doc response",e)})["catch"](function(t){"conflict"!==t.name&&o.$log.error(t)})}return t.prototype.get=function(t){return this.$q.resolve(this.db.get(t))},t.prototype.put=function(t){return this.$q.resolve(this.db.put(t))},t.prototype.allDocs=function(t){return this.$q.resolve(this.db.allDocs(t))},t.prototype.allNotes=function(){var t={startkey:"note",endkey:"noteï¿°",include_docs:!0};return this.$q.resolve(this.db.allDocs(t))},t.prototype.bulkDocs=function(t){return this.$q.resolve(this.db.bulkDocs(t))},t.prototype.query=function(t,e){return this.$q.resolve(this.db.query(t,e))},t.prototype.destroy=function(){return this.$q.resolve(this.db.destroy())},t.prototype.getNotesWithTag=function(t){var e=this;return this.query("tags",{reduce:!1,key:t}).then(function(t){return e.$log.info("note query response",t),t.rows.map(function(t){return{_id:t.id,title:t.value.title,tags:t.value.tags}})})["catch"](this.$log.error)},t.prototype.getAllTags=function(){var t=this;return this.query("tags",{reduce:!0,group:!0}).then(function(e){return t.$log.info("tag query response",e),e.rows.filter(function(t){return null!==t.key}).map(function(t){return{tag:t.key,notes:null}})})["catch"](this.$log.error)},t.$inject=["$log","$q"],t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=pouchdb;

},{"./pouchdb.design":10}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLnJvdXRpbmcudHMiLCJzcmMvYXBwLnRzIiwic3JjL2JyYWluL2JyYWluLmNvbnRyb2xsZXIudHMiLCJzcmMvYnJhaW4vYnJhaW4ubW9kdWxlLnRzIiwic3JjL2phbml0b3IvamFuaXRvci5jb250cm9sbGVyLnRzIiwic3JjL2phbml0b3IvamFuaXRvci5tb2R1bGUudHMiLCJzcmMvbmF2YmFyL25hdmJhci5tb2R1bGUudHMiLCJzcmMvbm90ZS9ub3RlLmNvbnRyb2xsZXIudHMiLCJzcmMvbm90ZS9ub3RlLm1vZHVsZS50cyIsInNyYy9wb3VjaGRiL3BvdWNoZGIuZGVzaWduLnRzIiwic3JjL3BvdWNoZGIvcG91Y2hkYi5tb2R1bGUudHMiLCJzcmMvcG91Y2hkYi9wb3VjaGRiLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7WUNFQSxRQUFBLGVBQUEsUUFBQSxjQUFBLE9BQUEsd0JBRUUsb0JBQ0EsaUJBQ0EscUJBRUEsU0FDRSxFQUNBLEVBQ0EsR0FHQSxFQUFrQixXQUFVLEdBRTVCLEVBQW1CLFVBQVUsS0FFN0IsRUFDQyxNQUFNLFNBQ0wsSUFBSyxJQUNMLFNBQVUsb0JBRVgsTUFBTSxXQUNMLFNBQVUsd0JBRVgsTUFBTSxRQUNMLFFBQ0UsS0FBTSxNQUVSLFNBQVU7OztZQzlCaEIsSUFBQSxlQUFBLFFBQW9CLGlCQUVwQixlQUFBLFFBQWtCLHdCQUNsQixpQkFBQSxRQUFvQiw0QkFDcEIsZ0JBQUEsUUFBbUIsMEJBQ25CLGNBQUEsUUFBaUIsc0JBQ2pCLGlCQUFBLFFBQW9CLDJCQUVwQixTQUFRLE9BQU8sWUFDYixZQUNBLGVBQUEsV0FDQSxpQkFBQSxXQUNBLGdCQUFBLFdBQ0EsY0FBQSxXQUNBLGlCQUFBLGFBRUQsT0FBTyxjQUFBOzs7WUNJUixJQUFBLGlCQUFBLFdBZ0JFLFFBQUEsR0FDVSxFQUNBLEVBQ0EsRUFDQSxFQUNBLEVBQ0Es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QSxjQUFBLE9BQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHsgSU5vdGUgfSBmcm9tICcuL25vdGUvbm90ZS5tb2R1bGUnO1xuXG5leHBvcnQgZGVmYXVsdCBbXG5cbiAgJyRsb2NhdGlvblByb3ZpZGVyJyxcbiAgJyRzdGF0ZVByb3ZpZGVyJyxcbiAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG5cbiAgKFxuICAgICRsb2NhdGlvblByb3ZpZGVyOiBuZy5JTG9jYXRpb25Qcm92aWRlcixcbiAgICAkc3RhdGVQcm92aWRlcjogbmcudWkuSVN0YXRlUHJvdmlkZXIsXG4gICAgJHVybFJvdXRlclByb3ZpZGVyOiBuZy51aS5JVXJsUm91dGVyUHJvdmlkZXJcbiAgKSA9PiB7XG5cbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG5cbiAgICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnYnJhaW4nLCB7XG4gICAgICB1cmw6ICcvJyxcbiAgICAgIHRlbXBsYXRlOiAnPGJyYWluPjwvYnJhaW4+J1xuICAgIH0pXG4gICAgLnN0YXRlKCdqYW5pdG9yJywge1xuICAgICAgdGVtcGxhdGU6ICc8amFuaXRvcj48L2phbml0b3I+J1xuICAgIH0pXG4gICAgLnN0YXRlKCdub3RlJywge1xuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIG5vdGU6IG51bGxcbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTogJzxub3RlPjwvbm90ZT4nXG4gICAgfSk7XG5cbiAgfVxuXTtcblxuaW50ZXJmYWNlIElTdGF0ZVBhcmFtcyB7XG4gIG5vdGU/OiBJTm90ZTtcbn07XG5cbmV4cG9ydCB7IElTdGF0ZVBhcmFtcyB9XG4iLCJpbXBvcnQgcm91dGluZyBmcm9tICcuL2FwcC5yb3V0aW5nJztcblxuaW1wb3J0IGJyYWluIGZyb20gJy4vYnJhaW4vYnJhaW4ubW9kdWxlJztcbmltcG9ydCBqYW5pdG9yIGZyb20gJy4vamFuaXRvci9qYW5pdG9yLm1vZHVsZSc7XG5pbXBvcnQgbmF2YmFyIGZyb20gJy4vbmF2YmFyL25hdmJhci5tb2R1bGUnO1xuaW1wb3J0IG5vdGUgZnJvbSAnLi9ub3RlL25vdGUubW9kdWxlJztcbmltcG9ydCBwb3VjaGRiIGZyb20gJy4vcG91Y2hkYi9wb3VjaGRiLm1vZHVsZSc7XG5cbmFuZ3VsYXIubW9kdWxlKCdzaGVybG9jaycsIFtcbiAgJ3VpLnJvdXRlcicsXG4gIGJyYWluLFxuICBqYW5pdG9yLFxuICBuYXZiYXIsXG4gIG5vdGUsXG4gIHBvdWNoZGJcbl0pXG4uY29uZmlnKHJvdXRpbmcpO1xuIiwiaW1wb3J0IHBvdWNoZGJTZXJ2aWNlIGZyb20gJy4uL3BvdWNoZGIvcG91Y2hkYi5zZXJ2aWNlJztcbmltcG9ydCB7IElOb3RlIH0gZnJvbSAnLi4vbm90ZS9ub3RlLm1vZHVsZSc7XG5cbmludGVyZmFjZSBMZXZlbFRhZyB7XG4gIHRhZzogc3RyaW5nO1xuICBub3RlczogTGV2ZWxOb3RlW107XG59XG5cbmludGVyZmFjZSBMZXZlbE5vdGUge1xuICBfaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgdGFnczogc3RyaW5nW107XG59XG5cbmludGVyZmFjZSBMZXZlbCB7XG4gIHNlbGVjdGVkVGFnOiBzdHJpbmc7XG4gIHRhZ3M6IExldmVsVGFnW107XG4gIG5vdGVzOiBMZXZlbE5vdGVbXTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQnJhaW5Db250cm9sbGVyIHtcblxuICBsZXZlbHM6IExldmVsW107XG4gIG5vdGU6IElOb3RlO1xuXG4gIHN0YXRpYyAkaW5qZWN0ID0gW1xuICAgICckZG9jdW1lbnQnLFxuICAgICckZWxlbWVudCcsXG4gICAgJyRsb2cnLFxuICAgICdwb3VjaGRiJyxcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlJyxcbiAgICAnJHRpbWVvdXQnLFxuICAgICckd2luZG93J1xuICBdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgJGRvY3VtZW50OiBuZy5JRG9jdW1lbnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgJGVsZW1lbnQ6IG5nLklBdWdtZW50ZWRKUXVlcnksXG4gICAgcHJpdmF0ZSAkbG9nOiBuZy5JTG9nU2VydmljZSxcbiAgICBwcml2YXRlIHBvdWNoZGI6IHBvdWNoZGJTZXJ2aWNlLFxuICAgIHByaXZhdGUgJHNjb3BlOiBuZy5JU2NvcGUsXG4gICAgcHJpdmF0ZSAkc3RhdGU6IG5nLnVpLklTdGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSAkdGltZW91dDogbmcuSVRpbWVvdXRTZXJ2aWNlLFxuICAgIHByaXZhdGUgJHdpbmRvdzogbmcuSVdpbmRvd1NlcnZpY2VcbiAgKSB7XG5cbiAgICB0aGlzLm5vdGUgPSBudWxsO1xuXG4gICAgLy8gQnVpbGQgbGV2ZWwgMFxuXG4gICAgdGhpcy5sZXZlbHMgPSBbe1xuICAgICAgc2VsZWN0ZWRUYWc6IG51bGwsXG4gICAgICB0YWdzOiBudWxsLFxuICAgICAgbm90ZXM6IG51bGxcbiAgICB9XTtcblxuICAgIC8vIEFsbCB0YWdzXG5cbiAgICB0aGlzLnBvdWNoZGIuZ2V0QWxsVGFncygpXG4gICAgLnRoZW4oKHRhZ3M6IExldmVsVGFnW10pID0+IHtcbiAgICAgIHRoaXMubGV2ZWxzWzBdLnRhZ3MgPSB0YWdzO1xuICAgIH0pO1xuXG4gICAgLy8gQWxsIG5vdGVzIHdpdGggemVybyB0YWdzXG5cbiAgICB0aGlzLnBvdWNoZGIuZ2V0Tm90ZXNXaXRoVGFnKG51bGwpXG4gICAgLnRoZW4oKGxldmVsTm90ZXM6IExldmVsTm90ZVtdKSA9PiB7XG4gICAgICB0aGlzLmxldmVsc1swXS5ub3RlcyA9IGxldmVsTm90ZXNcbiAgICB9KTtcblxuICB9XG5cbiAgJG9uSW5pdCgpIHtcbiAgICB0aGlzLiRsb2cuZGVidWcoJ0luaXRpYWxpemluZyBicmFpbiBjb21wb25lbnQnKTtcbiAgICB0aGlzLiR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy50cmFuc2xhdGUsIGZhbHNlKTtcbiAgfVxuXG4gICRvbkRlc3Ryb3koKSB7XG4gICAgdGhpcy4kbG9nLmRlYnVnKCdEZXN0cm95aW5nIGJyYWluIGNvbXBvbmVudCcpO1xuICAgIHRoaXMuJHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnRyYW5zbGF0ZSwgZmFsc2UpO1xuICB9XG5cbiAgb25UaXRsZU1vdXNlZW50ZXIobGV2ZWxOdW1iZXI6IG51bWJlciwgbGV2ZWxOb3RlOiBMZXZlbE5vdGUpIHtcbiAgICB0aGlzLm9wZW5Ob3RlKGxldmVsTm90ZS5faWQpO1xuICAgIHRoaXMuYXNzZXJ0TGV2ZWwobGV2ZWxOdW1iZXIpO1xuICAgIHRoaXMubGV2ZWxzW2xldmVsTnVtYmVyXS5zZWxlY3RlZFRhZyA9IG51bGw7XG4gIH1cblxuICBvcGVuTm90ZShub3RlSWQ6IHN0cmluZykge1xuICAgIHRoaXMuJGxvZy5kZWJ1Zygnb3BlbmluZyBub3RlJyk7XG4gICAgdGhpcy5wb3VjaGRiLmdldChub3RlSWQpXG4gICAgLnRoZW4oKG5vdGU6IElOb3RlKSA9PiB7XG4gICAgICB0aGlzLm5vdGUgPSBub3RlO1xuICAgICAgdGhpcy50cmFuc2xhdGUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsb3NlTm90ZSgpIHtcbiAgICBpZiAodGhpcy5ub3RlID09PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuJGxvZy5kZWJ1ZygnY2xvc2luZyBub3RlJyk7XG4gICAgdGhpcy5ub3RlID0gbnVsbDtcbiAgICB0aGlzLnRyYW5zbGF0ZSgpO1xuICB9XG5cbiAgLy8gQnVpbGQgdGhlIG5leHQgbGV2ZWwgb2YgdGFncyBhbmQgbm90ZXNcbiAgLy8gYmFzZWQgb24gdGhlIGN1cnJlbnQgbGV2ZWwgYW5kIGEgdGFnLlxuICBvblRhZ01vdXNlZW50ZXIobGV2ZWxOdW1iZXI6IG51bWJlciwgbGV2ZWxUYWc6IExldmVsVGFnKSB7XG4gICAgdGhpcy5jbG9zZU5vdGUoKTtcbiAgICB0aGlzLmFzc2VydExldmVsKGxldmVsTnVtYmVyKTtcbiAgICB0aGlzLmxldmVsc1tsZXZlbE51bWJlcl0uc2VsZWN0ZWRUYWcgPSBsZXZlbFRhZy50YWc7XG5cbiAgICB2YXIgaW5wdXRUYWdzID0gdGhpcy5sZXZlbHMubWFwKChsZXZlbCkgPT4ge1xuICAgICAgcmV0dXJuIGxldmVsLnNlbGVjdGVkVGFnO1xuICAgIH0pO1xuXG4gICAgaWYgKGxldmVsVGFnLm5vdGVzID09PSBudWxsKSB7XG4gICAgICB0aGlzLnBvdWNoZGIuZ2V0Tm90ZXNXaXRoVGFnKGxldmVsVGFnLnRhZylcbiAgICAgIC50aGVuKChsZXZlbE5vdGVzOiBMZXZlbE5vdGVbXSkgPT4ge1xuICAgICAgICB0aGlzLmJ1aWxkTmV4dExldmVsKGxldmVsTm90ZXMsIGlucHV0VGFncyk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmJ1aWxkTmV4dExldmVsKGxldmVsVGFnLm5vdGVzLCBpbnB1dFRhZ3MpO1xuICAgIH1cbiAgfVxuXG4gIGJ1aWxkTmV4dExldmVsKGxldmVsTm90ZXM6IExldmVsTm90ZVtdLCBpbnB1dFRhZ3M6IHN0cmluZ1tdKSB7XG4gICAgLy8gcHJvY2VzcyBhbGwgbGV2ZWxOb3Rlc1xuXG4gICAgdmFyIHRhZ05vdGVzOiB7W3RhZzogc3RyaW5nXTogTGV2ZWxOb3RlW119ID0ge307XG4gICAgdmFyIG5vdGVzOiBMZXZlbE5vdGVbXSA9IFtdO1xuXG4gICAgLy8gb25lIG5vdGUgcGVyIHJvd1xuICAgIGxldmVsTm90ZXMuZm9yRWFjaCgobGV2ZWxOb3RlKSA9PiB7XG4gICAgICB2YXIgaW50ZXJzZWN0aW9uID0gXy5pbnRlcnNlY3Rpb24oaW5wdXRUYWdzLCBsZXZlbE5vdGUudGFncyk7XG5cbiAgICAgIC8vIGV4YWN0IG1hdGNoLCBzaG93IGl0IGFzIGEgbm90ZS5cbiAgICAgIGlmIChpbnRlcnNlY3Rpb24ubGVuZ3RoID09PSBsZXZlbE5vdGUudGFncy5sZW5ndGgpIHtcbiAgICAgICAgbm90ZXMucHVzaChsZXZlbE5vdGUpO1xuICAgICAgfVxuICAgICAgLy8gcGFydGlhbCBtYXRjaDsgaW5jbHVkZSBpdCB1bmRlciB0YWdzXG4gICAgICBlbHNlIGlmIChpbnRlcnNlY3Rpb24ubGVuZ3RoID09PSBpbnB1dFRhZ3MubGVuZ3RoKSB7XG4gICAgICAgIGxldmVsTm90ZS50YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgIGlmIChfLmluY2x1ZGVzKGlucHV0VGFncywgdGFnKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIXRhZ05vdGVzW3RhZ10pIHtcbiAgICAgICAgICAgIHRhZ05vdGVzW3RhZ10gPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGFnTm90ZXNbdGFnXS5wdXNoKGxldmVsTm90ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gY29udmVydCB0YWcgbWFwIGludG8gbGlzdFxuXG4gICAgdmFyIGxldmVsVGFncyA9IE9iamVjdC5rZXlzKHRhZ05vdGVzKS5tYXAoKHRhZyk9PntcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhZzogdGFnLFxuICAgICAgICBub3RlczogPExldmVsTm90ZVtdPiB0YWdOb3Rlc1t0YWddXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgdmFyIHRhZ3MgPSBfLnNvcnRCeShsZXZlbFRhZ3MsICd0YWcnKTtcblxuICAgIHRoaXMubGV2ZWxzLnB1c2goe1xuICAgICAgc2VsZWN0ZWRUYWc6IG51bGwsXG4gICAgICB0YWdzOiB0YWdzLFxuICAgICAgbm90ZXM6IG5vdGVzXG4gICAgfSk7XG5cbiAgICB0aGlzLnRyYW5zbGF0ZSgpO1xuICB9XG5cbiAgLy8gcmVtb3ZlIGxldmVscyBhYm92ZSBuXG4gIGFzc2VydExldmVsKG46IG51bWJlcikge1xuICAgIGlmICh0aGlzLmxldmVscy5sZW5ndGggLSAxIDw9IG4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy4kbG9nLmRlYnVnKCdBc3NlcnQgbGV2ZWwgJywgbik7XG4gICAgdGhpcy5sZXZlbHMuc3BsaWNlKG4gKyAxLCB0aGlzLmxldmVscy5sZW5ndGgpO1xuICAgIHRoaXMudHJhbnNsYXRlKCk7XG4gIH1cblxuICBvbkxldmVsTW91c2VvdmVyKGV2ZW50OiBKUXVlcnlNb3VzZUV2ZW50T2JqZWN0LCBsZXZlbE51bWJlcjogbnVtYmVyKSB7XG4gICAgdGhpcy5jbG9zZU5vdGUoKTtcbiAgICB0aGlzLmFzc2VydExldmVsKGxldmVsTnVtYmVyKTtcbiAgICB0aGlzLmxldmVsc1tsZXZlbE51bWJlcl0uc2VsZWN0ZWRUYWcgPSBudWxsO1xuICB9XG5cbiAgdHJhbnNsYXRlID0gKCkgPT4ge1xuICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gbGV2ZWwgd2lkdGhzICsgbm90ZSB3aWR0aFxuICAgICAgdmFyIGNvbnRlbnRXaWR0aCA9IHRoaXMuY2FsY3VsYXRlV2lkdGgoJ2JyYWluIC5sZXZlbCcpICsgdGhpcy5jYWxjdWxhdGVXaWR0aCgnYnJhaW4gLm5vdGUnKTtcbiAgICAgIHZhciBvdXRlcldpZHRoID0gdGhpcy5jYWxjdWxhdGVFbGVtZW50V2lkdGgodGhpcy4kZWxlbWVudFswXSk7XG4gICAgICB2YXIgZGlmZiA9IE1hdGgubWF4KDAsIGNvbnRlbnRXaWR0aCAtIG91dGVyV2lkdGgpO1xuICAgICAgdmFyIHRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKC0nICsgZGlmZiArICdweCknO1xuICAgICAgdGhpcy4kZWxlbWVudC5jc3Moe1xuICAgICAgICB3ZWJraXRUcmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgICAgTW96VHJhbnNmb3JtOiB0cmFuc2Zvcm0sXG4gICAgICAgIG1zVHJhbnNmb3JtOiB0cmFuc2Zvcm0sXG4gICAgICAgIE9UcmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm1cbiAgICAgIH0pO1xuICAgICAgdGhpcy4kbG9nLmRlYnVnKCdUcmFuc2xhdGluZyAlcyBwaXhlbHMgdG8gdGhlIGxlZnQnLCBkaWZmKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlV2lkdGgoc2VsZWN0b3I6IHN0cmluZykge1xuICAgIHZhciBzdW0gPSAwO1xuICAgIHZhciBlbGVtZW50cyA9IHRoaXMuJGRvY3VtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHN1bSArPSB0aGlzLmNhbGN1bGF0ZUVsZW1lbnRXaWR0aChlbGVtZW50cy5pdGVtKGkpKTtcbiAgICB9XG4gICAgcmV0dXJuIHN1bTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlRWxlbWVudFdpZHRoKGVsZW1lbnQ6IEVsZW1lbnQpIHtcbiAgICB2YXIgd2lkdGggPSB0aGlzLiR3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKCd3aWR0aCcpO1xuICAgIHJldHVybiBwYXJzZUZsb2F0KHdpZHRoKTtcbiAgfVxuXG4gIGVkaXROb3RlKCkge1xuICAgIHRoaXMuJHN0YXRlLmdvKCdub3RlJywge25vdGU6IHRoaXMubm90ZX0pO1xuICB9XG5cbn1cbiIsImltcG9ydCBCcmFpbkNvbnRyb2xsZXIgZnJvbSAnLi9icmFpbi5jb250cm9sbGVyJztcblxuZXhwb3J0IGRlZmF1bHQgYW5ndWxhclxuLm1vZHVsZSgnc2hlcmxvY2suYnJhaW4nLCBbXSlcbi5jb21wb25lbnQoJ2JyYWluJywge1xuICB0ZW1wbGF0ZVVybDogJ3NyYy9icmFpbi9icmFpbi50ZW1wbGF0ZS5odG1sJyxcbiAgY29udHJvbGxlcjogQnJhaW5Db250cm9sbGVyXG59KVxuLm5hbWU7XG4iLCJpbXBvcnQgcG91Y2hkYlNlcnZpY2UgZnJvbSAnLi4vcG91Y2hkYi9wb3VjaGRiLnNlcnZpY2UnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBKYW5pdG9yQ29udHJvbGxlciB7XG5cbiAgbm90ZXM6IGFueVtdO1xuXG4gIHN0YXRpYyAkaW5qZWN0ID0gWyckbG9nJywncG91Y2hkYicsJyRzdGF0ZScsJyR3aW5kb3cnXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgcG91Y2hkYjogcG91Y2hkYlNlcnZpY2UsXG4gICAgcHJpdmF0ZSAkc3RhdGU6IG5nLnVpLklTdGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSAkd2luZG93OiBuZy5JV2luZG93U2VydmljZVxuICApIHtcblxuICAgIHRoaXMuZ2V0QWxsTm90ZXMoKTtcblxuICB9XG5cbiAgdG9Kc29uKG9iajogYW55KTogc3RyaW5nIHtcbiAgICByZXR1cm4gYW5ndWxhci50b0pzb24ob2JqLCB0cnVlKTtcbiAgfVxuXG4gIGdldEFsbE5vdGVzKCkge1xuXG4gICAgdGhpcy5wb3VjaGRiLmFsbE5vdGVzKClcbiAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgdGhpcy4kbG9nLmRlYnVnKCdhbGxOb3RlcyByZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgICAgIHRoaXMubm90ZXMgPSByZXNwb25zZS5yb3dzLm1hcCgocm93OiBhbnkpID0+IHtcbiAgICAgICAgcmV0dXJuIHJvdy5kb2M7XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5jYXRjaCh0aGlzLiRsb2cuZXJyb3IpO1xuXG4gIH1cblxuICBkZWxldGVBbGxOb3RlcygpIHtcblxuICAgIGlmICghdGhpcy4kd2luZG93LmNvbmZpcm0oJ1JlYWxseSBkZWxldGUgYWxsIG5vdGVzPycpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy4kbG9nLmRlYnVnKCdEZWxldGluZyBhbGwgbm90ZXMnKTtcblxuICAgIHZhciBkZWxldGVkTm90ZXMgPSB0aGlzLm5vdGVzLm1hcCgobm90ZTogYW55KSA9PiB7XG4gICAgICBub3RlLl9kZWxldGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiBub3RlO1xuICAgIH0pO1xuXG4gICAgdGhpcy5wb3VjaGRiLmJ1bGtEb2NzKGRlbGV0ZWROb3RlcylcbiAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgdGhpcy4kbG9nLmRlYnVnKCdidWxrRG9jcyByZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgICAgIHRoaXMubm90ZXMgPSBbXTtcbiAgICB9KVxuICAgIC5jYXRjaCh0aGlzLiRsb2cuZXJyb3IpO1xuXG4gIH1cblxuICBkZXN0cm95RGF0YWJhc2UoKSB7XG5cbiAgICBpZiAoIXRoaXMuJHdpbmRvdy5jb25maXJtKCdSZWFsbHkgZGVzdHJveSBkYXRhYmFzZT8nKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuJGxvZy5kZWJ1ZygnRGVzdHJveWluZyBkYXRhYmFzZScpO1xuXG4gICAgdGhpcy5wb3VjaGRiLmRlc3Ryb3koKS50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICB0aGlzLiRsb2cuZGVidWcoJ2RiIGRlc3Ryb3llZCByZXNwb25zZScscmVzcG9uc2UpO1xuICAgICAgdGhpcy5ub3RlcyA9IFtdO1xuICAgIH0pO1xuXG4gIH1cblxuICBnb1RvTm90ZShub3RlOiBhbnkpIHtcbiAgICB0aGlzLiRzdGF0ZS5nbygnbm90ZScsIHtcbiAgICAgIG5vdGU6IG5vdGVcbiAgICB9KTtcbiAgfVxuXG59XG4iLCJpbXBvcnQgSmFuaXRvckNvbnRyb2xsZXIgZnJvbSAnLi9qYW5pdG9yLmNvbnRyb2xsZXInO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyXG4ubW9kdWxlKCdzaGVybG9jay5qYW5pdG9yJywgW10pXG4uY29tcG9uZW50KCdqYW5pdG9yJywge1xuICB0ZW1wbGF0ZVVybDogJ3NyYy9qYW5pdG9yL2phbml0b3IudGVtcGxhdGUuaHRtbCcsXG4gIGNvbnRyb2xsZXI6IEphbml0b3JDb250cm9sbGVyXG59KVxuLm5hbWU7XG4iLCJleHBvcnQgZGVmYXVsdCBhbmd1bGFyXG4ubW9kdWxlKCdzaGVybG9jay5uYXZiYXInLCBbXSlcbi5jb21wb25lbnQoJ25hdmJhcicsIHtcbiAgdGVtcGxhdGVVcmw6ICdzcmMvbmF2YmFyL25hdmJhci50ZW1wbGF0ZS5odG1sJ1xufSlcbi5uYW1lO1xuIiwiaW1wb3J0IHBvdWNoZGJTZXJ2aWNlIGZyb20gJy4uL3BvdWNoZGIvcG91Y2hkYi5zZXJ2aWNlJztcbmltcG9ydCB7IElTdGF0ZVBhcmFtcyB9IGZyb20gJy4uL2FwcC5yb3V0aW5nJztcbmltcG9ydCB7IElOb3RlIH0gZnJvbSAnLi9ub3RlLm1vZHVsZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE5vdGVDb250cm9sbGVyIHtcblxuICB0aXRsZTogc3RyaW5nO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHRhZ3M6IHN0cmluZztcblxuICBzdGF0aWMgJGluamVjdCA9IFsnJGxvZycsJ3BvdWNoZGInLCckc3RhdGVQYXJhbXMnLCckd2luZG93J107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSAkbG9nOiBuZy5JTG9nU2VydmljZSxcbiAgICBwcml2YXRlIHBvdWNoZGI6IHBvdWNoZGJTZXJ2aWNlLFxuICAgIHByaXZhdGUgJHN0YXRlUGFyYW1zOiBJU3RhdGVQYXJhbXMsXG4gICAgcHJpdmF0ZSAkd2luZG93OiBuZy5JV2luZG93U2VydmljZVxuICApIHtcbiAgICB0aGlzLnNldE5vdGVTdGF0ZSgpO1xuICB9XG5cbiAgc2V0Tm90ZVN0YXRlKCkge1xuICAgIGlmICh0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlKSB7XG4gICAgICB0aGlzLnRpdGxlID0gdGhpcy4kc3RhdGVQYXJhbXMubm90ZS50aXRsZTtcbiAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUuY29udGVudDtcbiAgICAgIHRoaXMudGFncyA9IHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUudGFncy5qb2luKCcsJyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy50aXRsZSA9ICcnO1xuICAgICAgdGhpcy5jb250ZW50ID0gJyc7XG4gICAgICB0aGlzLnRhZ3MgPSAnJztcbiAgICB9XG4gIH1cblxuICBwdXROb3RlKCkge1xuXG4gICAgbGV0IG5vdGVJZDogc3RyaW5nO1xuICAgIGlmICh0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlKSB7XG4gICAgICBub3RlSWQgPSB0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlLl9pZDtcbiAgICB9XG5cbiAgICBsZXQgdGFnczogc3RyaW5nW107XG4gICAgaWYgKHRoaXMudGFncy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRhZ3MgPSBbXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0YWdzID0gdGhpcy50YWdzLnNwbGl0KCcsJyk7XG4gICAgfVxuXG4gICAgbGV0IG5vdGU6IElOb3RlID0ge1xuICAgICAgX2lkOiBub3RlSWQgfHwgdGhpcy5jcmVhdGVOb3RlSWQoKSxcbiAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLFxuICAgICAgY29udGVudDogdGhpcy5jb250ZW50LFxuICAgICAgdGFnczogdGFnc1xuICAgIH07XG5cbiAgICBpZiAodGhpcy4kc3RhdGVQYXJhbXMubm90ZSkge1xuICAgICAgbm90ZS5fcmV2ID0gdGhpcy4kc3RhdGVQYXJhbXMubm90ZS5fcmV2O1xuICAgIH1cblxuICAgIHRoaXMucG91Y2hkYi5wdXQobm90ZSlcbiAgICAudGhlbigocmVzcG9uc2U6IFBvdWNoVXBkYXRlUmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMuJGxvZy5pbmZvKHJlc3BvbnNlKTtcbiAgICAgIG5vdGUuX3JldiA9IHJlc3BvbnNlLnJldjtcbiAgICAgIHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUgPSBub3RlOy8vIVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnJvcjogUG91Y2hVcGRhdGVFcnJvcikgPT4ge1xuICAgICAgdGhpcy4kbG9nLmVycm9yKCdwdXQgbm90ZSBlcnJvcicsIGVycm9yKTtcbiAgICB9KTtcblxuICB9XG5cbiAgZGVsZXRlTm90ZSgpIHtcblxuICAgIGlmICghdGhpcy4kc3RhdGVQYXJhbXMubm90ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy4kd2luZG93LmNvbmZpcm0oJ1JlYWxseSBkZWxldGUgbm90ZT8nKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuJHN0YXRlUGFyYW1zLm5vdGUuX2RlbGV0ZWQgPSB0cnVlO1xuXG4gICAgdGhpcy5wb3VjaGRiLnB1dCh0aGlzLiRzdGF0ZVBhcmFtcy5ub3RlKVxuICAgIC50aGVuKChyZXNwb25zZTogUG91Y2hVcGRhdGVSZXNwb25zZSkgPT4ge1xuICAgICAgdGhpcy4kbG9nLmluZm8ocmVzcG9uc2UpO1xuICAgICAgdGhpcy4kc3RhdGVQYXJhbXMubm90ZSA9IG51bGw7Ly8hXG4gICAgICB0aGlzLnNldE5vdGVTdGF0ZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnJvcjogUG91Y2hVcGRhdGVFcnJvcikgPT4ge1xuICAgICAgdGhpcy4kbG9nLmVycm9yKCdkZWwgbm90ZSBlcnJvcicsIGVycm9yKTtcbiAgICB9KTtcblxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVOb3RlSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gJ25vdGUnICsgbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKTtcbiAgfVxuXG59XG4iLCJpbXBvcnQgTm90ZUNvbnRyb2xsZXIgZnJvbSAnLi9ub3RlLmNvbnRyb2xsZXInO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyXG4ubW9kdWxlKCdzaGVybG9jay5ub3RlJywgW10pXG4uY29tcG9uZW50KCdub3RlJywge1xuICB0ZW1wbGF0ZVVybDogJ3NyYy9ub3RlL25vdGUudGVtcGxhdGUuaHRtbCcsXG4gIGNvbnRyb2xsZXI6IE5vdGVDb250cm9sbGVyXG59KVxuLm5hbWU7XG5cbmludGVyZmFjZSBJTm90ZSB7XG4gIF9pZDogc3RyaW5nO1xuICBfcmV2Pzogc3RyaW5nO1xuICBfZGVsZXRlZD86IGJvb2xlYW47XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdGFnczogc3RyaW5nW107XG59XG5cbmludGVyZmFjZSBJTm90ZVBhcnRpYWwge1xuICBfaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgdGFnczogc3RyaW5nW107XG59XG5cbmV4cG9ydCB7IElOb3RlLCBJTm90ZVBhcnRpYWwgfVxuIiwiLy8gZGVzaWduIGRvY1xuLy8gZW1pdCBlYWNoIHRhZyBhcyBrZXlcbi8vIGVtaXQgdGl0bGUgYXMgdmFsdWVcblxuaW1wb3J0IHsgSU5vdGUgfSBmcm9tICcuLi9ub3RlL25vdGUubW9kdWxlJztcblxuZXhwb3J0IGRlZmF1bHQge1xuXG4gIF9pZDogJ19kZXNpZ24vdGFncycsXG5cbiAgdmlld3M6IHtcbiAgICB0YWdzOiB7XG5cbiAgICAgIG1hcDogZnVuY3Rpb24gKGRvYzogSU5vdGUpIHtcbiAgICAgICAgaWYgKGRvYy50YWdzKSB7XG4gICAgICAgICAgaWYgKGRvYy50YWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgZW1pdChudWxsLCB7dGl0bGU6IGRvYy50aXRsZSwgdGFnczogW119KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy50YWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIGVtaXQoZG9jLnRhZ3NbaV0sIHt0aXRsZTogZG9jLnRpdGxlLCB0YWdzOiBkb2MudGFnc30pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfS50b1N0cmluZygpLFxuXG4gICAgICByZWR1Y2U6ICdfY291bnQnXG5cbiAgICB9XG4gIH1cblxufVxuIiwiaW1wb3J0IHBvdWNoZGIgZnJvbSAnLi9wb3VjaGRiLnNlcnZpY2UnO1xuXG5leHBvcnQgZGVmYXVsdCBhbmd1bGFyXG4ubW9kdWxlKCdzaGVybG9jay5wb3VjaGRiJywgW10pXG4uc2VydmljZSgncG91Y2hkYicsIHBvdWNoZGIpXG4ubmFtZTtcbiIsImltcG9ydCBkZXNpZ24gZnJvbSAnLi9wb3VjaGRiLmRlc2lnbic7XG5pbXBvcnQgeyBJTm90ZSwgSU5vdGVQYXJ0aWFsIH0gZnJvbSAnLi4vbm90ZS9ub3RlLm1vZHVsZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIHBvdWNoZGIge1xuXG4gIHByaXZhdGUgZGI6IFBvdWNoREI7XG5cbiAgc3RhdGljICRpbmplY3QgPSBbXG4gICAgJyRsb2cnLFxuICAgICckcSdcbiAgXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgJHE6IG5nLklRU2VydmljZVxuICApIHtcblxuICAgIHRoaXMuZGIgPSBuZXcgUG91Y2hEQignc2hlcmxvY2snKTtcblxuICAgIC8vIFJlcGxpY2F0ZSBmcm9tIHNlcnZlclxuXG4gICAgLy8gSW5kZXggdGFnc1xuICAgIHRoaXMuZGIucHV0KGRlc2lnbilcbiAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgJGxvZy5kZWJ1ZygnZGVzaWduIGRvYyByZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgICB9KS5jYXRjaCgoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgLy8gY29uZmxpY3Qgb2s/XG4gICAgICBpZiAoZXJyb3IubmFtZSAhPT0gJ2NvbmZsaWN0Jykge1xuICAgICAgICB0aGlzLiRsb2cuZXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH1cblxuICBnZXQoaWQ6IHN0cmluZyk6IG5nLklQcm9taXNlPGFueT4ge1xuICAgIC8vIHdhaXQgZm9yIGluZGV4IHByb21pc2U/XG4gICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZSh0aGlzLmRiLmdldChpZCkpO1xuICB9XG5cbiAgcHV0KGRvYzogYW55KTogbmcuSVByb21pc2U8YW55PiB7XG4gICAgLy8gd2FpdCBmb3IgaW5kZXggcHJvbWlzZT9cbiAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHRoaXMuZGIucHV0KGRvYykpO1xuICB9XG5cbiAgYWxsRG9jcyhvcHRpb25zOiBQb3VjaEFsbERvY3NPcHRpb25zKTogbmcuSVByb21pc2U8YW55PiB7XG4gICAgLy8gd2FpdCBmb3IgaW5kZXggcHJvbWlzZT9cbiAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHRoaXMuZGIuYWxsRG9jcyhvcHRpb25zKSk7XG4gIH1cblxuICBhbGxOb3RlcygpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICAvLyB3YWl0IGZvciBpbmRleCBwcm9taXNlP1xuXG4gICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICBzdGFydGtleTogJ25vdGUnLFxuICAgICAgZW5ka2V5OiAnbm90ZVxcdWZmZjAnLFxuICAgICAgaW5jbHVkZV9kb2NzOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHRoaXMuZGIuYWxsRG9jcyhvcHRpb25zKSk7XG4gIH1cblxuICBidWxrRG9jcyhkb2NzOiBhbnlbXSk6IG5nLklQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLiRxLnJlc29sdmUodGhpcy5kYi5idWxrRG9jcyhkb2NzKSk7XG4gIH1cblxuICBxdWVyeSh2aWV3TmFtZTogc3RyaW5nLCBvcHRpb25zOiBhbnkpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy4kcS5yZXNvbHZlKHRoaXMuZGIucXVlcnkodmlld05hbWUsIG9wdGlvbnMpKTtcbiAgfVxuXG4gIGRlc3Ryb3koKTogbmcuSVByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuJHEucmVzb2x2ZSh0aGlzLmRiLmRlc3Ryb3koKSk7XG4gIH1cblxuICAvLyBHZXQgbm90ZXMgd2l0aCBzcGVjaWZpZWQgdGFnLlxuICAvLyAoY29udGVudCBleGNsdWRlZCBmcm9tIG5vdGVzKVxuICBnZXROb3Rlc1dpdGhUYWcodGFnOiBzdHJpbmcpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeSgndGFncycsIHtcbiAgICAgIHJlZHVjZTogZmFsc2UsXG4gICAgICBrZXk6IHRhZ1xuICAgIH0pXG4gICAgLnRoZW4oKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgIHRoaXMuJGxvZy5pbmZvKCdub3RlIHF1ZXJ5IHJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgICAgLy8gb25lIG5vdGUgcGVyIHJvd1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnJvd3MubWFwKChyb3c6IFBvdWNoUXVlcnlSb3cpID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBfaWQ6IHJvdy5pZCxcbiAgICAgICAgICB0aXRsZTogcm93LnZhbHVlLnRpdGxlLFxuICAgICAgICAgIHRhZ3M6IHJvdy52YWx1ZS50YWdzXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5jYXRjaCh0aGlzLiRsb2cuZXJyb3IpO1xuICB9XG5cbiAgZ2V0QWxsVGFncygpOiBuZy5JUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeSgndGFncycsIHtcbiAgICAgIHJlZHVjZTogdHJ1ZSxcbiAgICAgIGdyb3VwOiB0cnVlXG4gICAgfSlcbiAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgdGhpcy4kbG9nLmluZm8oJ3RhZyBxdWVyeSByZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgICAgIC8vIG9uZSB0YWcgcGVyIHJvd1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLnJvd3NcbiAgICAgIC5maWx0ZXIoKHJvdzogUG91Y2hRdWVyeVJvdyk9PntcbiAgICAgICAgcmV0dXJuIHJvdy5rZXkgIT09IG51bGw7XG4gICAgICB9KVxuICAgICAgLm1hcCgocm93OiBQb3VjaFF1ZXJ5Um93KSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGFnOiByb3cua2V5LFxuICAgICAgICAgIG5vdGVzOiA8SU5vdGVQYXJ0aWFsPiBudWxsXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5jYXRjaCh0aGlzLiRsb2cuZXJyb3IpO1xuICB9XG5cbn1cbiJdfQ==
